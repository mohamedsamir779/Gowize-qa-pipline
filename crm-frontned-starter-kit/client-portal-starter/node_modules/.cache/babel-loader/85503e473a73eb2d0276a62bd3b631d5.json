{"ast":null,"code":"/* eslint-disable indent *//* eslint-disable object-curly-newline *//* eslint-disable react/no-unescaped-entities *//* eslint-disable semi *//* eslint-disable quotes */import React,{useRef,useState,useEffect}from\"react\";import\"./SelfieCamera.css\";import{Button}from\"reactstrap\";import{useTranslation}from\"react-i18next\";import{fetchDocsStart}from\"store/general/documents/actions\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function SelfieCamera(_ref){let{onCapture,toggleTab,activeStep}=_ref;const videoRef=useRef(null);const canvasRef=useRef(null);const[stream,setStream]=useState(null);const[photo,setPhoto]=useState(null);const[facingMode,setFacingMode]=useState(\"user\");const[hasPermission,setHasPermission]=useState(null);const[error,setError]=useState(null);const[saveStatus,setSaveStatus]=useState(\"\");const{t}=useTranslation();useEffect(()=>{fetchDocsStart();return()=>{stopCamera();};},[]);// Start the camera\nconst startCamera=async()=>{try{const mediaStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:facingMode,width:{ideal:1280},height:{ideal:720}},audio:false});setStream(mediaStream);if(videoRef.current){videoRef.current.srcObject=mediaStream;}setHasPermission(true);setError(null);}catch(err){console.error(\"Error accessing camera:\",err);setError(err.message||\"Could not access camera\");setHasPermission(false);}};// Stop the camera\nconst stopCamera=()=>{if(stream){stream.getTracks().forEach(track=>track.stop());setStream(null);}};// Toggle between front and rear camera\nconst toggleCamera=()=>{stopCamera();setFacingMode(prev=>prev===\"user\"?\"environment\":\"user\");};// Take a photo\nconst takePhoto=()=>{if(!videoRef.current||!stream)return;const video=videoRef.current;const canvas=canvasRef.current;const context=canvas.getContext(\"2d\");canvas.width=video.videoWidth;canvas.height=video.videoHeight;context.drawImage(video,0,0,canvas.width,canvas.height);const photoDataUrl=canvas.toDataURL(\"image/jpeg\",0.8);photoDataUrl==\"data:,\"?setPhoto(null):setPhoto(photoDataUrl);stopCamera();if(onCapture){onCapture(photoDataUrl);}};// Save photo to localStorage and proceed\nconst handleContinue=()=>{if(photo){console.log(\"Saving photo:\",photo);try{localStorage.setItem(\"selfiePhoto\",photo);setSaveStatus(\"Photo saved successfully!\");toggleTab(activeStep+1);stopCamera();}catch(error){setSaveStatus(\"Error saving photo: \"+error.message);}}else{setSaveStatus(\"Please take a photo first\");}toggleTab(activeStep+1);};// Clean up camera on unmount\nuseEffect(()=>{return()=>{stopCamera();};},[]);// Start/stop camera when facingMode changes\nuseEffect(()=>{startCamera();return()=>stopCamera();},[facingMode]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"selfie-camera-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Take a Selfie\"}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",children:[/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"p\",{children:\"Please ensure you've granted camera permissions.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"camera-preview\",children:[hasPermission&&!photo?/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,playsInline:true,muted:true,className:\"video-element\"}):/*#__PURE__*/_jsx(\"div\",{className:\"camera-placeholder\",children:photo?/*#__PURE__*/_jsx(\"img\",{src:photo,alt:\"Captured selfie\",className:\"captured-photo-preview\"}):/*#__PURE__*/_jsx(\"p\",{children:\"Camera not available\"})}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,style:{display:\"none\"}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"camera-controls\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:takePhoto,className:\"capture-btn\",disabled:!hasPermission,children:\"Take Photo\"}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleCamera,className:\"switch-camera-btn\",disabled:!hasPermission,children:facingMode===\"user\"?\"Switch to Rear Camera\":\"Switch to Front Camera\"})]}),saveStatus&&/*#__PURE__*/_jsx(\"div\",{className:\"save-status \".concat(saveStatus.includes(\"success\")?\"success\":\"error\"),children:saveStatus})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"my-4 text-center\",children:[/*#__PURE__*/_jsx(Button,{className:\"btn btn-primary m-2 btn-sm w-lg\",onClick:()=>{toggleTab(activeStep-1);stopCamera();},children:t(\"Back\")}),/*#__PURE__*/_jsx(Button,{className:\"btn btn-success m-2 btn-sm w-lg\",type:\"submit\",onClick:handleContinue,disabled:!photo||photo===\"data:,\",children:t(\"Continue\")})]})]});}","map":{"version":3,"names":["React","useRef","useState","useEffect","Button","useTranslation","fetchDocsStart","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","SelfieCamera","_ref","onCapture","toggleTab","activeStep","videoRef","canvasRef","stream","setStream","photo","setPhoto","facingMode","setFacingMode","hasPermission","setHasPermission","error","setError","saveStatus","setSaveStatus","t","stopCamera","startCamera","mediaStream","navigator","mediaDevices","getUserMedia","video","width","ideal","height","audio","current","srcObject","err","console","message","getTracks","forEach","track","stop","toggleCamera","prev","takePhoto","canvas","context","getContext","videoWidth","videoHeight","drawImage","photoDataUrl","toDataURL","handleContinue","log","localStorage","setItem","children","className","ref","autoPlay","playsInline","muted","src","alt","style","display","onClick","disabled","concat","includes","type"],"sources":["/home/ubuntu/king/portal/client-portal-starter/src/components/Deposit/Methods/VisaMaster/SelfieCamera/SelfieCamera.js"],"sourcesContent":["/* eslint-disable indent */\n/* eslint-disable object-curly-newline */\n/* eslint-disable react/no-unescaped-entities */\n/* eslint-disable semi */\n/* eslint-disable quotes */\nimport React, { useRef, useState, useEffect } from \"react\";\nimport \"./SelfieCamera.css\";\nimport { Button } from \"reactstrap\";\nimport { useTranslation } from \"react-i18next\";\nimport { fetchDocsStart } from \"store/general/documents/actions\";\n\nexport default function SelfieCamera({ onCapture, toggleTab, activeStep }) {\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [stream, setStream] = useState(null);\n  const [photo, setPhoto] = useState(null);\n  const [facingMode, setFacingMode] = useState(\"user\");\n  const [hasPermission, setHasPermission] = useState(null);\n  const [error, setError] = useState(null);\n  const [saveStatus, setSaveStatus] = useState(\"\");\n\n\n  const { t } = useTranslation();\n\n  useEffect(() => {\n    fetchDocsStart();\n\n    return () => {\n      stopCamera();\n    };\n  }, []);\n\n  // Start the camera\n  const startCamera = async () => {\n    try {\n      const mediaStream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          facingMode: facingMode,\n          width: { ideal: 1280 },\n          height: { ideal: 720 },\n        },\n        audio: false,\n      });\n\n      setStream(mediaStream);\n      if (videoRef.current) {\n        videoRef.current.srcObject = mediaStream;\n      }\n      setHasPermission(true);\n      setError(null);\n    } catch (err) {\n      console.error(\"Error accessing camera:\", err);\n      setError(err.message || \"Could not access camera\");\n      setHasPermission(false);\n    }\n  };\n\n  // Stop the camera\n  const stopCamera = () => {\n    if (stream) {\n      stream.getTracks().forEach((track) => track.stop());\n      setStream(null);\n    }\n  };\n\n  // Toggle between front and rear camera\n  const toggleCamera = () => {\n    stopCamera();\n    setFacingMode((prev) => (prev === \"user\" ? \"environment\" : \"user\"));\n  };\n\n  // Take a photo\n  const takePhoto = () => {\n    if (!videoRef.current || !stream) return;\n\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    const context = canvas.getContext(\"2d\");\n\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n    const photoDataUrl = canvas.toDataURL(\"image/jpeg\", 0.8);\n    photoDataUrl == \"data:,\" ? setPhoto(null) : setPhoto(photoDataUrl);\n\n    stopCamera();\n\n    if (onCapture) {\n      onCapture(photoDataUrl);\n    }\n  };\n\n  // Save photo to localStorage and proceed\n  const handleContinue = () => {\n    if (photo) {\n      console.log(\"Saving photo:\", photo);\n\n      try {\n        localStorage.setItem(\"selfiePhoto\", photo);\n        setSaveStatus(\"Photo saved successfully!\");\n        toggleTab(activeStep + 1);\n        stopCamera();\n      } catch (error) {\n        setSaveStatus(\"Error saving photo: \" + error.message);\n      }\n    } else {\n      setSaveStatus(\"Please take a photo first\");\n    }\n    toggleTab(activeStep + 1);\n  };\n\n  // Clean up camera on unmount\n  useEffect(() => {\n    return () => {\n      stopCamera();\n    };\n  }, []);\n\n  // Start/stop camera when facingMode changes\n  useEffect(() => {\n    startCamera();\n    return () => stopCamera();\n  }, [facingMode]);\n\n  return (\n    <>\n      <div className=\"selfie-camera-container\">\n        <h2>Take a Selfie</h2>\n\n        {error && (\n          <div className=\"error-message\">\n            <p>{error}</p>\n            <p>Please ensure you've granted camera permissions.</p>\n          </div>\n        )}\n\n        <div className=\"camera-preview\">\n          {hasPermission && !photo ? (\n            <video\n              ref={videoRef}\n              autoPlay\n              playsInline\n              muted\n              className=\"video-element\"\n            />\n          ) : (\n            <div className=\"camera-placeholder\">\n              {photo ? (\n                <img\n                  src={photo}\n                  alt=\"Captured selfie\"\n                  className=\"captured-photo-preview\"\n                />\n              ) : (\n                <p>Camera not available</p>\n              )}\n            </div>\n          )}\n\n          <canvas ref={canvasRef} style={{ display: \"none\" }} />\n        </div>\n\n        <div className=\"camera-controls\">\n          <button\n            onClick={takePhoto}\n            className=\"capture-btn\"\n            disabled={!hasPermission}\n          >\n            Take Photo\n          </button>\n\n          <button\n            onClick={toggleCamera}\n            className=\"switch-camera-btn\"\n            disabled={!hasPermission}\n          >\n            {facingMode === \"user\"\n              ? \"Switch to Rear Camera\"\n              : \"Switch to Front Camera\"}\n          </button>\n        </div>\n\n        {saveStatus && (\n          <div\n            className={`save-status ${\n              saveStatus.includes(\"success\") ? \"success\" : \"error\"\n            }`}\n          >\n            {saveStatus}\n          </div>\n        )}\n      </div>\n      <div className=\"my-4 text-center\">\n        <Button\n          className=\"btn btn-primary m-2 btn-sm w-lg\"\n          onClick={() => {\n            toggleTab(activeStep - 1);\n            stopCamera();\n          }}\n        >\n          {t(\"Back\")}\n        </Button>\n        <Button\n          className=\"btn btn-success m-2 btn-sm w-lg\"\n          type=\"submit\"\n          onClick={handleContinue}\n          disabled={!photo || photo === \"data:,\"}\n        >\n          {t(\"Continue\")}\n        </Button>\n      </div>\n    </>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}