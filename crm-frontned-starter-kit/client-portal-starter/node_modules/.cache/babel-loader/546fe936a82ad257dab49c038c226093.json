{"ast":null,"code":"import{pdf}from\"@react-pdf/renderer\";import axios from\"axios\";import*as content from\"content\";import store from\"../store/index.js\";import PdfOfVisa from\"../components/Journey/Profiles/Applications/PdfOfVisa.js\";import{jsx as _jsx}from\"react/jsx-runtime\";export const getSecureLink=async(id,index)=>{try{var _JSON$parse;const{data}=await axios.get(\"\".concat(content.apiUrl,\"/api/v1/crm/documents/\").concat(id,\"/\").concat(index),{headers:{Authorization:\"Bearer \".concat((_JSON$parse=JSON.parse(localStorage.getItem(\"authUser\")))===null||_JSON$parse===void 0?void 0:_JSON$parse.token)}});return data.result;}catch(error){console.error(\"Error fetching secure link:\",error);return null;}};export const uploadPDF=async()=>{try{var _state$Profile,_state$documents,_JSON$parse2;const state=store.store.getState();// or just `store.getState()` depending on your setup\nconst clientData=((_state$Profile=state.Profile)===null||_state$Profile===void 0?void 0:_state$Profile.clientData)||{};const documents=((_state$documents=state.documents)===null||_state$documents===void 0?void 0:_state$documents.documents)||[];const savedSignature=localStorage.getItem(\"savedSignature\")||\"\";const selfiePhoto=localStorage.getItem(\"selfiePhoto\")||\"\";const ipLinks=await Promise.all(documents.filter(doc=>doc.type===\"ID\").map((doc,i)=>getSecureLink(doc._id,i+1)));const addressLinks=await Promise.all(documents.filter(doc=>doc.type===\"ADDRESS\").map((doc,i)=>getSecureLink(doc._id,i+1)));const blob=await pdf(/*#__PURE__*/_jsx(PdfOfVisa,{clientData:clientData,documents:documents,ipLinks:ipLinks,addressLinks:addressLinks,selfiePhoto:selfiePhoto,savedSignature:savedSignature})).toBlob();const formData=new FormData();formData.append(\"file\",blob,\"document.pdf\");formData.append(\"clientId\",clientData._id);const response=await axios.post(\"\".concat(content.apiUrl,\"/api/v1/cp/psp/checkout/uploadprofile\"),formData,{headers:{\"Content-Type\":\"multipart/form-data\",Authorization:\"Bearer \".concat((_JSON$parse2=JSON.parse(localStorage.getItem(\"authUser\")))===null||_JSON$parse2===void 0?void 0:_JSON$parse2.token)}});// localStorage.removeItem(\"selfiePhoto\");\n// localStorage.removeItem(\"savedSignature\");\nreturn response.data;}catch(error){console.error(\"Error generating or uploading PDF:\",error);throw error;}};","map":{"version":3,"names":["pdf","axios","content","store","PdfOfVisa","jsx","_jsx","getSecureLink","id","index","_JSON$parse","data","get","concat","apiUrl","headers","Authorization","JSON","parse","localStorage","getItem","token","result","error","console","uploadPDF","_state$Profile","_state$documents","_JSON$parse2","state","getState","clientData","Profile","documents","savedSignature","selfiePhoto","ipLinks","Promise","all","filter","doc","type","map","i","_id","addressLinks","blob","toBlob","formData","FormData","append","response","post"],"sources":["/home/ubuntu/king/portal/client-portal-starter/src/helpers/uploadPdf.js"],"sourcesContent":["import { pdf } from \"@react-pdf/renderer\";\nimport axios from \"axios\";\nimport * as content from \"content\";\nimport store from \"../store/index.js\";\nimport PdfOfVisa from \"../components/Journey/Profiles/Applications/PdfOfVisa.js\";\n\nexport const getSecureLink = async (id, index) => {\n  try {\n    const { data } = await axios.get(\n      `${content.apiUrl}/api/v1/crm/documents/${id}/${index}`,\n      {\n        headers: {\n          Authorization: `Bearer ${\n            JSON.parse(localStorage.getItem(\"authUser\"))?.token\n          }`,\n        },\n      }\n    );\n    return data.result;\n  } catch (error) {\n    console.error(\"Error fetching secure link:\", error);\n    return null;\n  }\n};\n\nexport const uploadPDF = async () => {\n  try {\n    const state = store.store.getState(); // or just `store.getState()` depending on your setup\n    const clientData = state.Profile?.clientData || {};\n    const documents = state.documents?.documents || [];\n    const savedSignature = localStorage.getItem(\"savedSignature\") || \"\";\n    const selfiePhoto = localStorage.getItem(\"selfiePhoto\") || \"\";\n\n    const ipLinks = await Promise.all(\n      documents\n        .filter((doc) => doc.type === \"ID\")\n        .map((doc, i) => getSecureLink(doc._id, i + 1))\n    );\n\n    const addressLinks = await Promise.all(\n      documents\n        .filter((doc) => doc.type === \"ADDRESS\")\n        .map((doc, i) => getSecureLink(doc._id, i + 1))\n    );\n\n    const blob = await pdf(\n      <PdfOfVisa\n        clientData={clientData}\n        documents={documents}\n        ipLinks={ipLinks}\n        addressLinks={addressLinks}\n        selfiePhoto={selfiePhoto}\n        savedSignature={savedSignature}\n      />\n    ).toBlob();\n    const formData = new FormData();\n    formData.append(\"file\", blob, \"document.pdf\");\n    formData.append(\"clientId\", clientData._id);\n    const response = await axios.post(\n      `${content.apiUrl}/api/v1/cp/psp/checkout/uploadprofile`,\n      formData,\n      {\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n          Authorization: `Bearer ${\n            JSON.parse(localStorage.getItem(\"authUser\"))?.token\n          }`,\n        },\n      }\n    );\n    // localStorage.removeItem(\"selfiePhoto\");\n    // localStorage.removeItem(\"savedSignature\");\n\n    return response.data;\n  } catch (error) {\n    console.error(\"Error generating or uploading PDF:\", error);\n    throw error;\n  }\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}