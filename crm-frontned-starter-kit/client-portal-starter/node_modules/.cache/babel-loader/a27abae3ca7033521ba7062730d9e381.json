{"ast":null,"code":"import _objectSpread from\"/home/ubuntu/king/portal/client-portal-starter/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{socket}from\"./index\";const updateMarkets=(currentMarkets,newData)=>{newData.forEach(market=>{const exists=currentMarkets.find(x=>x.pairName===market.pairName);if(!exists)currentMarkets.push(market);});let updatedData=currentMarkets;updatedData=updatedData.map(market=>{const found=newData.find(x=>x.pairName===market.pairName);return _objectSpread(_objectSpread({},market),found);});return updatedData;};const updateKlines=(currentKlines,newKline)=>{if(currentKlines.symbol!==newKline.symbol)return currentKlines;currentKlines.data.push(newKline);return currentKlines;};const updateOrderBooks=(currentOrderBooks,newData)=>{const exists=currentOrderBooks.find(x=>x.pairName===newData.pairName);if(!exists)currentOrderBooks.push(newData);let updatedData=currentOrderBooks;updatedData=updatedData.map(ob=>{const found=newData.pairName===ob.pairName;if(found){return _objectSpread(_objectSpread({},ob),newData);}else{return ob;}});return updatedData;};export const socketEvents=_ref=>{let{state,setState}=_ref;if(state.markupId){socket.on(\"pricing_6297aced413064506c846939\",()=>{});}socket.on(\"pricing\",msg=>{setState(state=>{const message=JSON.parse(msg);const markets=updateMarkets(state.markets,message);return _objectSpread(_objectSpread({},state),{},{markets});});});const klineEvent=state.markupId?\"kline_\".concat(state.markupId):\"kline\";socket.on(klineEvent,msg=>{setState(state=>{const message=JSON.parse(msg);// chart accepts kline times in secs\nmessage.time/=1000;const klines=updateKlines(state.klines,message);return _objectSpread(_objectSpread({},state),{},{klines});});});socket.on(\"orderbook\",msg=>{setState(state=>{const message=JSON.parse(msg);const orderBooks=updateOrderBooks(state.orderBooks,message);return _objectSpread(_objectSpread({},state),{},{orderBooks});});});};","map":{"version":3,"names":["socket","updateMarkets","currentMarkets","newData","forEach","market","exists","find","x","pairName","push","updatedData","map","found","_objectSpread","updateKlines","currentKlines","newKline","symbol","data","updateOrderBooks","currentOrderBooks","ob","socketEvents","_ref","state","setState","markupId","on","msg","message","JSON","parse","markets","klineEvent","concat","time","klines","orderBooks"],"sources":["/home/ubuntu/king/portal/client-portal-starter/src/socket/events.js"],"sourcesContent":["import { socket } from \"./index\";\n\nconst updateMarkets = (currentMarkets, newData) => {\n  newData.forEach(market => {\n    const exists = currentMarkets.find((x) => x.pairName === market.pairName);\n    if (!exists) currentMarkets.push(market);\n  });\n  let updatedData = currentMarkets;\n  updatedData = updatedData.map((market) => {\n    const found = newData.find((x) => x.pairName === market.pairName);\n    return {\n      ...market,\n      ...found\n    };\n  });\n  return updatedData;\n};\nconst updateKlines = (currentKlines, newKline) => {\n  if (currentKlines.symbol !== newKline.symbol) return currentKlines;\n  currentKlines.data.push(newKline);\n  return currentKlines;\n};\n\nconst updateOrderBooks = (currentOrderBooks, newData) => {\n  const exists = currentOrderBooks.find((x) => x.pairName === newData.pairName);\n  if (!exists) currentOrderBooks.push(newData);\n  let updatedData = currentOrderBooks;\n  updatedData = updatedData.map((ob) => {\n    const found = newData.pairName === ob.pairName;\n    if (found) {\n      return {\n        ...ob,\n        ...newData,\n      };\n    } else {\n      return ob;\n    }\n  });\n  return updatedData;\n};\n\nexport const socketEvents = ({ state, setState }) => {\n  if (state.markupId) {\n    socket.on(\"pricing_6297aced413064506c846939\", () => {\n    });\n  }\n  socket.on(\"pricing\", (msg) => {\n    setState(state => {\n      const message = JSON.parse(msg);\n      const markets = updateMarkets(state.markets, message);\n      return {\n        ...state,\n        markets\n      };\n    });\n  });\n  const klineEvent = state.markupId ? `kline_${state.markupId}` : \"kline\";\n  socket.on(klineEvent, (msg) => {\n    setState(state => {\n      const message = JSON.parse(msg);\n      // chart accepts kline times in secs\n      message.time /= 1000;\n      const klines = updateKlines(state.klines, message);\n      return {\n        ...state,\n        klines\n      };\n    });\n  });\n\n  socket.on(\"orderbook\", (msg) => {\n    setState(state => {\n      const message = JSON.parse(msg);\n      const orderBooks = updateOrderBooks(state.orderBooks, message);\n      return {\n        ...state,\n        orderBooks\n      };\n    });\n  });\n};"],"mappings":"mIAAA,OAASA,MAAM,KAAQ,SAAS,CAEhC,KAAM,CAAAC,aAAa,CAAGA,CAACC,cAAc,CAAEC,OAAO,GAAK,CACjDA,OAAO,CAACC,OAAO,CAACC,MAAM,EAAI,CACxB,KAAM,CAAAC,MAAM,CAAGJ,cAAc,CAACK,IAAI,CAAEC,CAAC,EAAKA,CAAC,CAACC,QAAQ,GAAKJ,MAAM,CAACI,QAAQ,CAAC,CACzE,GAAI,CAACH,MAAM,CAAEJ,cAAc,CAACQ,IAAI,CAACL,MAAM,CAAC,CAC1C,CAAC,CAAC,CACF,GAAI,CAAAM,WAAW,CAAGT,cAAc,CAChCS,WAAW,CAAGA,WAAW,CAACC,GAAG,CAAEP,MAAM,EAAK,CACxC,KAAM,CAAAQ,KAAK,CAAGV,OAAO,CAACI,IAAI,CAAEC,CAAC,EAAKA,CAAC,CAACC,QAAQ,GAAKJ,MAAM,CAACI,QAAQ,CAAC,CACjE,OAAAK,aAAA,CAAAA,aAAA,IACKT,MAAM,EACNQ,KAAK,EAEZ,CAAC,CAAC,CACF,MAAO,CAAAF,WAAW,CACpB,CAAC,CACD,KAAM,CAAAI,YAAY,CAAGA,CAACC,aAAa,CAAEC,QAAQ,GAAK,CAChD,GAAID,aAAa,CAACE,MAAM,GAAKD,QAAQ,CAACC,MAAM,CAAE,MAAO,CAAAF,aAAa,CAClEA,aAAa,CAACG,IAAI,CAACT,IAAI,CAACO,QAAQ,CAAC,CACjC,MAAO,CAAAD,aAAa,CACtB,CAAC,CAED,KAAM,CAAAI,gBAAgB,CAAGA,CAACC,iBAAiB,CAAElB,OAAO,GAAK,CACvD,KAAM,CAAAG,MAAM,CAAGe,iBAAiB,CAACd,IAAI,CAAEC,CAAC,EAAKA,CAAC,CAACC,QAAQ,GAAKN,OAAO,CAACM,QAAQ,CAAC,CAC7E,GAAI,CAACH,MAAM,CAAEe,iBAAiB,CAACX,IAAI,CAACP,OAAO,CAAC,CAC5C,GAAI,CAAAQ,WAAW,CAAGU,iBAAiB,CACnCV,WAAW,CAAGA,WAAW,CAACC,GAAG,CAAEU,EAAE,EAAK,CACpC,KAAM,CAAAT,KAAK,CAAGV,OAAO,CAACM,QAAQ,GAAKa,EAAE,CAACb,QAAQ,CAC9C,GAAII,KAAK,CAAE,CACT,OAAAC,aAAA,CAAAA,aAAA,IACKQ,EAAE,EACFnB,OAAO,EAEd,CAAC,IAAM,CACL,MAAO,CAAAmB,EAAE,CACX,CACF,CAAC,CAAC,CACF,MAAO,CAAAX,WAAW,CACpB,CAAC,CAED,MAAO,MAAM,CAAAY,YAAY,CAAGC,IAAA,EAAyB,IAAxB,CAAEC,KAAK,CAAEC,QAAS,CAAC,CAAAF,IAAA,CAC9C,GAAIC,KAAK,CAACE,QAAQ,CAAE,CAClB3B,MAAM,CAAC4B,EAAE,CAAC,kCAAkC,CAAE,IAAM,CACpD,CAAC,CAAC,CACJ,CACA5B,MAAM,CAAC4B,EAAE,CAAC,SAAS,CAAGC,GAAG,EAAK,CAC5BH,QAAQ,CAACD,KAAK,EAAI,CAChB,KAAM,CAAAK,OAAO,CAAGC,IAAI,CAACC,KAAK,CAACH,GAAG,CAAC,CAC/B,KAAM,CAAAI,OAAO,CAAGhC,aAAa,CAACwB,KAAK,CAACQ,OAAO,CAAEH,OAAO,CAAC,CACrD,OAAAhB,aAAA,CAAAA,aAAA,IACKW,KAAK,MACRQ,OAAO,GAEX,CAAC,CAAC,CACJ,CAAC,CAAC,CACF,KAAM,CAAAC,UAAU,CAAGT,KAAK,CAACE,QAAQ,UAAAQ,MAAA,CAAYV,KAAK,CAACE,QAAQ,EAAK,OAAO,CACvE3B,MAAM,CAAC4B,EAAE,CAACM,UAAU,CAAGL,GAAG,EAAK,CAC7BH,QAAQ,CAACD,KAAK,EAAI,CAChB,KAAM,CAAAK,OAAO,CAAGC,IAAI,CAACC,KAAK,CAACH,GAAG,CAAC,CAC/B;AACAC,OAAO,CAACM,IAAI,EAAI,IAAI,CACpB,KAAM,CAAAC,MAAM,CAAGtB,YAAY,CAACU,KAAK,CAACY,MAAM,CAAEP,OAAO,CAAC,CAClD,OAAAhB,aAAA,CAAAA,aAAA,IACKW,KAAK,MACRY,MAAM,GAEV,CAAC,CAAC,CACJ,CAAC,CAAC,CAEFrC,MAAM,CAAC4B,EAAE,CAAC,WAAW,CAAGC,GAAG,EAAK,CAC9BH,QAAQ,CAACD,KAAK,EAAI,CAChB,KAAM,CAAAK,OAAO,CAAGC,IAAI,CAACC,KAAK,CAACH,GAAG,CAAC,CAC/B,KAAM,CAAAS,UAAU,CAAGlB,gBAAgB,CAACK,KAAK,CAACa,UAAU,CAAER,OAAO,CAAC,CAC9D,OAAAhB,aAAA,CAAAA,aAAA,IACKW,KAAK,MACRa,UAAU,GAEd,CAAC,CAAC,CACJ,CAAC,CAAC,CACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}